head	2.1;
access;
symbols;
locks; strict;
comment	@# @;


2.1
date	2005.01.03.16.41.25;	author tg;	state Exp;
branches;
next	;


desc
@@


2.1
log
@work over most of the changes MirOS has done, and add
the new or copied/moved files
@
text
@<?xml version="1.0" encoding="iso-2022-jp"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ja" lang="ja">
  <head>

    <title>DNSとApacheについての問題</title>
  </head>
  <!-- Background white, links blue (unvisited), navy (visited), red (active) -->
  <!-- English Revision: 1.14 -->
  <body bgcolor="#FFFFFF" text="#000000" link="#0000FF"
  vlink="#000080" alink="#FF0000">
        <div align="CENTER">
      <img src="images/sub.gif" alt="[APACHE DOCUMENTATION]" /> 

      <h3>Apache HTTP Server</h3>
    </div>



    <h1 align="center">DNS と Apache にまつわる注意事項</h1>

    <p>本文書の内容は次の一言世某圓泙后草痺蒹
が誓瀋螢侫．ぅ襪鯑匹濆爐箸纃渉林
を使用する必要がないようにして下さい</em>。Apache
    が誓瀋螢侫．ぅ襪鯑匹濆爐箸林
を使用する必要がある場合、信頼誓量簑ぢ起動しないかもしれません)
    やサービス拒否、盗用アタック(他のユーザからヒットを盗むことを含みます)
    の問題に直面するかもしれません。</p>

    <h3>簡単な例</h3>
    この誓瀋衫磴鮃佑┐討澆泙
錫跫站髟阡緇
腫鱚帷鶯貳闢痰祟粹蹙苳嚆鴟纈槍迚砒蜥貔節矣闕
弟笊辣銓呰阡痰蜥瘡被齡
鹿頏緇
鹿碎閭鞫
腫樵鞜竏が誓犠錣傍’修垢襪砲蓮▲弌璽船礇襯曠好箸瓦箸防再鵑弔
情報が必要になります。それは、
    <a href="mod/core.html#servername"><code>ServerName</code></a>
    と、そのサーバが応答するための IP アドレス(最低一つ) です。
    この例では IP アドレスを含んでいませんので、Apache は DNS
    を使用して <code>www.abc.dom</code> を見つけなければなりません。
    誓瀋螢侫．ぅ襪鯑匹濆鵑任い襪箸鵬燭蕕陵海林
が利用できなかった場合、
    バーチャルホストは<strong>誓瀋蠅気譴泙擦鹿齡鳫鈑ぢ。
    そして、そのバーチャルホストに対するヒットには応答がなされません
    (Apache 1.2 以前では起動すらしません)。</p>

    <p><code>www.abc.dom</code> のアドレスが 10.0.0.1
    だ世箸靴泙后任蓮⊆，寮設定について考えてみましょう。</p>

    <blockquote>
<pre>
    &lt;VirtualHost 10.0.0.1&gt;
    ServerAdmin webgirl@@abc.dom
    DocumentRoot /www/abc
    &lt;/VirtualHost&gt;
</pre>
    </blockquote>

    <p>現在 Apache は DNS 逆引きを使用してこのバーチャルホストの
    <code>ServerName</code> を見つけます。
    その逆引きが失敗した場合は部分的にバーチャルホストを無効にします
    (Apache 1.2 より前では起動すらしません)。
    バーチャルホストが名前ベースであれば完全に無効になりますが、
    IP ベースであれば概ね動作します。しかしながら、サーバ名を含む完全な
    URL を誓言成しなければならない場合は、誓気靴厂ぢの誓言成ができません。
    </p>

    <p>次の例は上記の問題を解決しています。</p>

    <blockquote>
<pre>
    &lt;VirtualHost 10.0.0.1&gt;
    ServerName www.abc.dom
    ServerAdmin webgirl@@abc.dom
    DocumentRoot /www/abc
    &lt;/VirtualHost&gt;
</pre>
    </blockquote>

    <h3>サービス拒否</h3>

    <p>サービス拒否が起こる場合、(少なくとも) 二つのケースがあります。
    Apache 1.2 より前を実行している場合、バーチャルホストのための
    上記の二つの DNS 検索のうち一つでも失敗すれば起動すらしません。
    またこの DNS 検索が自分の誓羃爾砲垢蕕覆ぞ豺腓發△蠅┐泙后
例えば、<code>abc.dom</code> が顧客のサーバの一つで、
    DNS は顧客自身で管理している場合、顧客は単に
    <code>www.abc.dom</code> レコードを削除するだ世韻如
┗ぢより前の) サーバを起動不能にすることができます。</p>

    <p>もう一つのケースは、より気付きにくいものです。
    次の誓瀋蠅砲弔い胴佑┐討澆泙靴腓Α鹿霈

錫跫站髟阡緇
腫鱚帷鶯貳闢痰祟粹蹙苳嚆鴟纈槍迚砒蜥貔節矣闕
弟笊辣銓呰阡痰蜥瘡被齡
鹿頏緇
鹿碎閭鞫
錫跫站髟阡緇
腫鱚帷鶯貳闢粤罧粹蹙苳嚆鴟纈槍迚砒誓粤罧粹弟笊辣銓呰阡粤蜥瘡被齡
鹿頏緇
鹿碎閭鞫
腫庄握握握を <code>www.abc.dom</code> に、10.0.0.2 を
    <code>www.def.dom</code> に割り当てているとします。また、
    <code>def.com</code> は顧客自身の DNS
    の誓羃爾砲△襪箸靴泙后海寮設定で、<code>abc.com</code>
    に向けられたトラフィックすべてを奪うことができる位置に
    <code>def.com</code> を誓瀉屬任討い泙后８紊話韻
若閼緇粤罧粹躰閼緇ぢが 10.0.0.1
    を参照するように誓瀋蠅垢襪誓けです。DNS
    は顧客側でコントロールされているので、<code>www.def.com</code>
    レコードが好きな場所を指すように誓瀋蠅垢襪里鮖澆瓩襪海箸任泙擦鵝
鹿霈

腫庄握握握に対するリクエスト
    (<code>http://www.abc.dom/whatever</code> 形式の URL 
    を入力したユーザからのものすべてを含みます) 
    は、<code>def.dom</code> バーチャルホストで応答されます。
    このようなことが何故起こるかもっとよく知るためには、
    応答の必要なバーチャルホストへのリクエストに対して、
    Apache がどのように誓姐臉性を確保するかについて、
    深い議論世廚砲覆蠅泙后泙弊説明世釈
蓿繙就闢續瘟踈譬ぢこちら</a>に記述されています。</p>

    <h3>「主要なサーバ」のアドレス</h3>

    <p>Apache 1.1 で追加された<a href="vhosts/name-based.html">
    名前ベースのバーチャルホストのサポート</a>により、httpd
    が動作しているホストの IP アドレスを、Apache 
    が知っている必要があります。このアドレスを得世襪燭瓩法
ぢもしあれば)グローバルの <code>ServerName</code> や C の
    <code>gethostname</code> ファンクションコール
    (これはコマンドプロンプトで "hostname"
    と打ち込むのと同じ結果を返します。) を使用します。
    それからこのアドレスの DNS 検索を行ないます。
    現時点世任蓮△海慮〆硫麋鯤，浪燭發△蠅泙擦鵝鹿霈

腫渉林ぢサーバのダ瀬Ε鵑彊任海離襯奪▲奪廚最圓垢襪里魘欧譴訃豺隋
若閼緇闢鹿竢粤に hostname を挿入することができます。
    (マシンが誓犠錣傍阿任襪茲Δ法△海譴呂修蕕紡減澆靴泙后それから、DNS が失敗したときに確実に <code>/etc/hosts</code>
    を使用するように誓瀋蠅靴泙后匹鵑を使っているかによりますが、
    <code>/etc/resolv.conf</code> や <code>/etc/nsswitch.conf</code>
    を編集することによって完誓任泙后鹿霈

腫ぢもしサーバが他の理由により DNS を実行する必要が何もなければ、
    Apache を <code>HOSTRESORDER</code> 環境変数を "local" に誓瀋蠅靴
実行することで問題を避けることができるかもしれません。これは使用している
    OS とリゾルバライブラリに依存します。
    これは <a href="mod/mod_env.html"><code>mod_env</code></a>
    を使って環境変数を誓罎靴討い覆じ造蝓断にも影響します。
    OS の man ページや FAQ を参照するようにしてくだ世気ぁ
鹿霈

取馨釈篏♯蜷鵞瘢綵♯蜷鵞ぢこれらの問題を避ける秘訣</a></h3>


    <ul>
      <li><code>&lt;VirtualHost&gt;</code> 中に IP アドレスを使う</li>

      <li><code>Listen</code> 中に IP アドレスを使う</li>

      <li><code>BindAddress</code> 中に IP アドレスを使う</li>

      <li>すべてのバーチャルホストに対し明声竢粤肖纈鯲瘢綣閼緇
を確実に与える
      </li>

      <li>応答するページのない <code>&lt;VirtualHost _default_:*&gt;</code>
      サーバを作誓垢鹿跚鹿
取馨付録： 将来的な方向誓鹿莖
腫渉林ぢに関して、現状は全く宜しくありません。Apache 1.2 で、 DNS 
    のイベントが失敗しても少なくとも起動プロセスが続くようにしましたが、 
    これが最高の解決方法ではないでしょう。アドレスの再割り当てが
    必要不可避 となっている今日のインターネットにおいては、
    誓瀋螢侫．ぅ襪涼罎婆誓示的な IP アドレスを要求する仕様は、
    全く宜しくありません。
    </p>

    <p>上で誓睫誓したサービス盗用攻撃に対して可能な対策は、
    DNS の誓軌砲茲衒屬気譴アドレスから DNS の逆引きを実行し、
    その二つの名前を比較することです。一致しない場合バーチャルホストは無効にされます。
    これには、DNS の逆引きが適誓擇棒設定されている必要があります。(DNS
    の「二重の逆引き」は FTP サーバや TCP
    ラッパーにより一般的に使われているため、
    ほとんどの管理者には馴誓澆里△襪發里任靴腓ぢ。
    </p>

    <p>IP アドレスが使用されていなくて DNS が失敗した場合は、
    どうしてもバーチャルホストウェブサーバを信頼誓魍諒櫃靴
起動させることは不可能のようです。誓瀋蠅琉貮瑤鯡妓砲垢襪箸いΔ茲Δ
部分的な解決は、サーバの目的にもよりますが
    起動しないよりも悪いかもしれません。</p>

    <p>HTTP/1.1 が開発され、ブラウザやプロキシが <code>Host</code>
    ヘッダ世鯣圓垢襪茲Δ砲覆辰燭里如賓ぢベースのバーチャルホストを
    全く使用しなくても済むようになるかもしれません。
    この場合、ウェブサーバは誓瀋蠱罎林ぢ参照をしなくても済みます。
    しかし 1997 年 3 月時点世両靴任蓮
商用レベルのウェブサーバで使用できるほどには、
    これらの機能は広く開発が進んでいません。
        <hr />

    <h3 align="CENTER">Apache HTTP Server</h3>
    <a href="./"><img src="images/index.gif" alt="Index" /></a>

    </p>
  </body>
</html>

@
