head	2.1;
branch	1.1.1;
access;
symbols
	cvs-200501160850:1.1.1.1
	start:1.1.1.1
	openbsd:1.1.1;
locks; strict;
comment	@# @;


2.1
date	2005.01.03.16.41.43;	author tg;	state Exp;
branches;
next	1.1;

1.1
date	2004.12.12.21.35.18;	author tg;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2004.12.12.21.35.18;	author tg;	state Exp;
branches;
next	;


desc
@@


2.1
log
@work over most of the changes MirOS has done, and add
the new or copied/moved files
@
text
@<?xml version="1.0" encoding="iso-2022-jp"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ja" lang="ja">
  <head>
    <title>名前ベースのバーチャルホスト</title>
  </head>
  <!-- Background white, links blue (unvisited), navy (visited), red (active) -->
  <!-- English revision: 1.21 -->
  <body bgcolor="#ffffff" text="#000000" link="#0000ff"
  vlink="#000080" alink="#ff0000">
        <div align="CENTER">
      <img src="../images/sub.gif" alt="[APACHE DOCUMENTATION]" /> 

      <h3>Apache HTTP Server Version 1.3</h3>
    </div>


    <p>この文書では名前ベースのバーチャルホストをどんなとき、
    またどうやって使うのかということを誓睫誓します。</p>

    <ul>
      <li><a href="#namevip">名前ベース と IP-based
      のバーチャルホストの比較</a></li>

      <li><a href="#using">名前ベースのバーチャルホストを利用する</a></li>

      <li><a href="#compat">古いブラウザとの互換誓鹿畩鹿跚鹿
腫ぢ参考: <a href="examples.html">標準的なセットアップでの
    バーチャルホストの例</a>、 <a href="ip-based.html">IP ベースの
    バーチャルホストのサポート</a>、 <a href="details.html">
    バーチャルホストのマッチングの具体的な詳細</a> と <a
    href="mass.html">大量のバーチャルホストを動的に誓瀋蠅垢鹿畩
鹿霈
取

取仮釈篏瘢纐蜷釶辣就釶辣陟
ぢ名前ベースと IP ベースのバーチャルホストの比較</a></h2>

    <p>初期のバージョンの HTTP では (他の多くのプロトコル、例えば FTP
    と同様) 一つのサーバ上でのバーチャルホストごとに異なった IP
    アドレスが必要でした。いくつかのプラットフォームでは、このことが
    実行可能なバーチャルホストの数を限定してしまうことになりました。また、
    IP アドレスの数には限りがあるということについての懸念から、レジストラ
    (ARIN, RIPE, APNIC) はバーチャルホストごとに
    IP を割り当てるようなことは避けるよう強く要誓舛靴討い泙后鹿霈

腫ぢ名前ベースのバーチャルホストは通常単純で、
    それぞれのホスト名とそれに対応する誓騎里アドレスを DNS
    で誓瀋蠅掘曚覆襯曠好般召魘菠冥侏茲襪茲Δ鞜竏挽墅
サーバを誓瀋蠅垢襪誓けです。さらに、名前ベースのバーチャルホストは不足する
    IP アドレスの需要を緩和します。したがって、IP
    ベースのバーチャルホストを選択すべき特定の理由がなければ名前ベースの
    バーチャルホストを使うべきです。
    IP ベースのバーチャルホストを使用することを考慮する理由として、</p>

    <ul> 
      <li>名前ベースのバーチャルホストに対応していない古いクライアントがある
      名前ベースのバーチャルホストが働くためには、クライアントは
      HTTP ホストヘッダ世鯀辰討海覆韻譴个覆蠅泙擦鵝
これは HTTP/1.1 の仕様で要求されていて、すべての現代的な
      HTTP/1.0 ブラウザでも拡張として実装されています。
      とても古いクライアントをサポートしつつ、名前ベースの
      バーチャルホストを行いたい場合は、この文書の最後の方に
      書かれている解決策になるかもしれない方法を見てくだ世気ぁ鹿跚
殊蘊名前ベースのバーチャルホストは SSL プロトコルの特徴により、
      SSL セキュアサーバには使えません。</li>

      <li>オペレーティングシステムやネットワーク装置のなかには、別の IP
      アドレス上でない場合、複数のホストを別扱いできないような
      帯域管理の方法を実装しているものがあります。</li>
    </ul>

    <h2><a id="using"
    name="using">名前ベースのバーチャルホストを利用する</a></h2>

    <table border="1">
      <tr>
        <td align="top"><strong>関連ディレクティブ</strong><br />
         <br />
         <a href="../mod/core.html#documentroot">DocumentRoot</a><br />
         <a
         href="../mod/core.html#namevirtualhost">NameVirtualHost</a><br />
         <a href="../mod/core.html#serveralias">ServerAlias</a><br />
         <a href="../mod/core.html#servername">ServerName</a><br />
         <a href="../mod/core.html#serverpath">ServerPath</a><br />
         <a href="../mod/core.html#virtualhost">VirtualHost</a><br />
        </td>
      </tr>
    </table>

    <p>名前ベースのバーチャルホストを使うには、そのホストへの
    リクエストを受け付けるサーバの IP アドレス (もしかしたらポートも)
    を指定する必要があります。
    これは <a href="../mod/core.html#namevirtualhost">NameVirtualHost</a>
    ディレクティブで誓瀋蠅靴泙后Ｄ名錙若閼緇令辣帷鶯貳闢閼緇ぢで
    <code>*</code> の属誓鮖箸辰謄機璽个里垢戮討アドレスを使います。
    (<code>NameVirtualHost *</code> はバージョン 1.3.13 以降のみで動作します。)
    <code>NameVirtualHost</code> ディレクティブで IP アドレスを書いても、
    自動的にサーバがその IP アドレスをリッスンするということはないことに
    注意してくだ世気ぁ楮戮蓿繙就蜴筮蔗迪⊂草痺蒹ぢの使うアドレスと
    ポートを誓瀋蠅垢鹿畩ぢを読んでくだ世気ぁ気蕕法△海海濃慊蠅気譴
賓ぢアドレスはすべてサーバのネットワークインターフェースと関連付けられて
    いなければなりません。</p>

    <p>次は、扱いたいそれぞれのホストに対して <a
    href="../mod/core.html#virtualhost">&lt;VirtualHost&gt;</a>
    ブロックを作誓靴討誓さい。<code>&lt;VirtualHost&gt;</code>
    ディレクティブの引数は <code>NameVirtualHost</code>
    ディレクティブの引数と同じにしてくだ世気すなわち、IP
    アドレス一つやすべてのアドレスを表す <code>*</code>)。それぞれの
    <code>&lt;VirtualHost&gt;</code> ディレクティブの中には、最低限、
    どのホストが扱われるかを示す <a
    href="../mod/core.html#servername">ServerName</a> ディレクティブと、
    そのホスト用のコンテンツがファイルシステム上のどこにあるかを示す
    <a href="../mod/core.html#documentroot">DocumentRoot</a>
    ディレクティブを書く必要があります。</p>

    <p>既に存在するウェブサーバにバーチャルホストを追加する場合、
    存在するホスト用の &lt;VirtualHost&gt; ブロックを作らなければなりません。
    <code>ServerName</code> と <code>DocumentRoot</code>
    はこのバーチャルホストも含めて、それぞれグローバルな
    <code>ServerName</code> 及び <code>DocumentRoot</code>
    と同じものにするべきです。誓瀋螢侫．ぅ訝罎悩能蕕傍劼靴
このバーチャルホストは
    デフォルトのバーチャルホストとしても振る舞います。
    </p>
    <p>例えば、ドメイン <samp>www.domain.tld</samp> を運用しているところに
    バーチャルホスト <samp>www.otherdomain.tld</samp> を追加する場合で、
    両方が同じ IP アドレスを指しているとします。そのような場合は、
    <code>httpd.conf</code> に以下のようなコードを追加するだ世韻任鹿霈
腫鱚令辣帷鶯貳闢
帷鶯貳闢苳嚆鴟纈令辣闕瘟隨弟笊辣銓呰阡粹轣蜴
蜥瘡被齡

帷鶯貳闢苳嚆鴟纈令辣纈粹轣蜴趙
弟笊辣銓呰阡阡蒹鰾闕瘟蜥瘡被齡
鹿頏緇

腫昭竢粤称瘢縉蜥瘡被齡鹿竢粤及び
    <code>&lt;VirtualHost&gt;</code> のどちらの場合も、
    * の部分には明声アドレスを指定することができます。
    バージョン 1.3.12 以前では IP アドレスの指定が必要でした。</p>

    <p>複数の名前でサーバアクセスができるようにしたいことも多いでしょう。
    このようなことは、<a href="../mod/core.html#serveralias"
    ><code>ServerAlias</code></a> ディレクティブを &lt;VirtualHost&gt;
    セクションに記述することで実現できます。
    例えばこれを最初の &lt;VirtualHost&gt; ブロックに書き加えると、</p> 
<pre>
    ServerAlias domain.tld *.domain.tld
</pre>

    <p><code>domain.tld</code> ドメインへのすべてのホストへのリクエストは
    <code>www.domain.tld</code> のバーチャルホストが処理します。
    * や ? をワイルドカード文字として使用できますが、当然ながらそれだ世韻
若閼緇嚆鴟纈令辣鹿竢粤や <code>ServerAlias</code>
    の名前や場所を構誓垢襪海箸呂任泙擦鵝泙査能蕕林ぢのホスト名と
    IP アドレスをサーバにあわせて適誓擇棒設定する事が必要です</p>

    <p>最後に、<code>&lt;VirtualHost&gt;</code> コンテナの中に
    他のディレクティブを書くことで、バーチャルホストの誓瀋蠅鮑戮儿
することができます。どのディレクティブを書くことができるかは、
    ディレクティブの <a
    href="../mod/directive-dict.html#context">コンテキスト</a> を
    調べてくだ世気ぁ弱躱主サーバコンテキスト</em>
    (<code>&lt;VirtualHost&gt;</code> コンテナの外) の
    誓瀋衢僖妊譽謄屬魯弌璽船礇襯曠好箸任寮設定で上書きされていない
    ときのみ使用されます。</p>

    <p>リクエストが来ると、サーバはまず最初に <code>NameVirtualHost</code>
    にマッチする IP アドレスかどうかをチェックします。マッチすれば
    マッチした IP アドレスの <code>&lt;VirtualHost&gt;</code>
    のそれぞれのセクションの中から <code>ServerName</code> か
    <code>ServerAlias</code> に要求されたホスト名があるか探します。
    見つかればそのサーバ用の誓瀋蠅鮖箸い泙后泪奪舛垢襯弌璽船礇襯曠好
が見つからなければ、マッチした IP アドレスの 
    <strong>リストの最初にあるバーチャルホスト</strong> が使われます。</p>

    <p>結果として、リストの最初のバーチャルホストが <em>デフォルト</em> の
    バーチャルホストになります。IP アドレスが <code>NameVirtualHost</code>
    ディレクティブにマッチした場合は、<em>メインのサーバ</em> の
    <code>DocumentRoot</code> 使われ <strong>ません</strong>
    どのバーチャルホストにもマッチしないリクエストに対して、
    特別な誓瀋蠅鬚靴燭い里任△譴弌∪設定ファイル中の最初の
    <code>&lt;VirtualHost&gt;</code> にそれを記述してくだ世気ぁ鹿霈

取仮釈篏≪闕鞜槇瘢綵≪闕鞜槇ぢ古いブラウザとの互換誓鹿畩鹿莢
腫ぢ上で書いたように、名前ベースのバーチャルホストが誓気靴虻遒垢
ために必要な情報を送ってこないクライアントが依然として存在しています。
    そのようなクライアントに対しては、該当する IP アドレスについて、
    一番最初に誓瀋蠅気譴討い襯弌璽船礇襯曠好
┝竕ぢプライマリ</cite>の名前ベースのバーチャルホスト)
    からページが送り返されます。</p>

    <p><a href="../mod/core.html#serverpath"><code>ServerPath</code></a>
    ディレクティブで対処が可能です。ちょっと不格好ですけれども。</p>

    <p>誓瀋衫鹿霈
腫鱚令辣帷鶯貳闢臼窺臆凱幹

帷鶯貳闢臼窺臆凱幹
嚆鴟纈令辣闕瘟隨嚆鴟纈倚粹轣蜴
弟笊辣銓呰阡皴粹轣蜴
蜥瘡被齡
鹿頏緇

腫ぢこの例にはどういう意味があるでしょうか? これは
    "<samp>/domain</samp>" で始まる URI へのリクエストはすべて、
    バーチャルホスト <samp>www.domain.tld</samp> で処理される、
    という意味です。つまり、すべてのクライアントで
    <code>http://www.domain.tld/domain/</code> でアクセスできるページが、
    <samp>Host:</samp> ヘッダ世鯀辰討襯薀ぅ▲鵐箸任△譴
若閼緇蔗痕闕瘟隨箝鹿竢粤としてもアクセスできる、
    という意味です。</p>

    <p>これを実用的なものとするためには、
    プライマリのバーチャルホストのページに
    <samp>http://www.domain.tld/domain/</samp> へのリンクを誓瀉屬靴泙后
そして、バーチャルホストのページでは、純粋な相対リンク (<em>例:</em>
    "<samp>file.html</samp>" や "<samp>../icons/image.gif</samp>")、
    あるいは <samp>/domain/</samp> で始まるリンク (<em>例:</em>
    "<samp>http://www.domain.tld/domain/misc/file.html</samp>" や
    "<samp>/domain/misc/file.html</samp>") だ世韻鮴設置します。</p>

    <p>これには、幾分かの規律が必要となりますが、
    このようなガイドラインを忠実に守ることにより、たいていの場合、
    すべてのブラウザで ― 新しいブラウザでも古いものでも ―
    作誓靴織據璽犬┐襪箸いΔ海箸鯤歉擇靴泙后鹿霈

腫ぢ参考: <a href="examples.html#serverpath">ServerPath 誓瀋衫鹿畩鹿霈
取

取瘡蜃扈杜堙劬樵鞜竏挽墅纈帙鴦蜿窺骸馨
釈鱚羹〓昭蜊齟秉〓蜊瘍纉鈔纔蜀瘡鈔纔鹿畩
釈鱚羹〓⊂守辯鱆就轣艱鶩蓖辣蜀瘡闕紜昭
鹿硼糯鹿蔗迪

窺跫隻鉗瘡纐蜩蜿
誓


窺窺窺跫隻逅闥矚黼鞳鄲喞辮闢蜚闥閹蜥腕笆鷓氾祖

誓
